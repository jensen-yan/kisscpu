#### ä»Šæ—¥ä»»åŠ¡

1. å®Œæˆ1ä¸ªæµ‹è¯•çš„debugå·¥ä½œ! åº”è¯¥è¿˜æ˜¯loadæŒ‡ä»¤æœ‰é—®é¢˜



å½“å‰bug: è·‘add æµ‹è¯•æ—¶å€™, å‘ç°æ•°æ®æ®µå†…å®¹ä¼¼ä¹æ²¡æœ‰å­˜å…¥å†…å­˜,è·‘sumè¿™æ ·æ²¡æœ‰æ•°æ®æ®µå†…å®¹çš„æµ‹è¯•å°±èƒ½æ­£ç¡®é€šè¿‡, ç”¨objdumpçœ‹äº†elfæ–‡ä»¶, è¿™é‡Œçš„d70 æ•°æ®åŒºæ˜¯æœ‰å€¼çš„, ä½†æ˜¯ç”¨Cè¯­è¨€å»æ‰“å°d70çš„å€¼æœ‰é—®é¢˜

è§£å†³:  åº”è¯¥åªæœ‰ä¸€ä¸ªRam, æŒ‡ä»¤æ®µå’Œæ•°æ®æ®µåˆ†åˆ«å­˜æ”¾åœ¨Ramçš„ä¸åŒä½ç½®, çœ‹elfæ–‡ä»¶å°±èƒ½æ˜ç™½ -Dé€‰é¡¹å¯ä»¥æ‰“å°å…¨éƒ¨å†…å®¹, æ‰€ä»¥åˆ é™¤æ•°æ®Ramè¿™ä¸ªå¤§æ•°ç»„å³å¯



```
reg 10 a0 different at pc = [0x        8000008c], right=[0x               0], wrong=[0x       100000000]  cyc= 234

add:
0000000080000030 <main>:
    80000030:	fc010113          	addi	sp,sp,-64
    80000034:	01513423          	sd	s5,8(sp)
    80000038:	01613023          	sd	s6,0(sp)
    8000003c:	00001a97          	auipc	s5,0x1
    80000040:	d54a8a93          	addi	s5,s5,-684 # 80000d90 <ans>
    80000044:	00001b17          	auipc	s6,0x1
    80000048:	d2cb0b13          	addi	s6,s6,-724 # 80000d70 <test_data>
    8000004c:	01313c23          	sd	s3,24(sp)
    80000050:	01413823          	sd	s4,16(sp)
    80000054:	02113c23          	sd	ra,56(sp)
    80000058:	02813823          	sd	s0,48(sp)
    8000005c:	02913423          	sd	s1,40(sp)
    80000060:	03213023          	sd	s2,32(sp)
    80000064:	000a8993          	mv	s3,s5
    80000068:	000b0a13          	mv	s4,s6
    8000006c:	000a2903          	lw	s2,0(s4)
    80000070:	000a8493          	mv	s1,s5
    80000074:	000b0413          	mv	s0,s6
    80000078:	00042503          	lw	a0,0(s0)
    8000007c:	0004a783          	lw	a5,0(s1)
    80000080:	00440413          	addi	s0,s0,4
    80000084:	0125053b          	addw	a0,a0,s2
    // a0 = 0xffffffff80000000 = 0x000000007fffffff + 1
    // æˆ‘çš„ç»“æœå¯èƒ½ä¸º 0x 0000 80000
    80000088:	40f50533          	sub	a0,a0,a5 cyc=232
    // a0 = 0xffffffff80000000 - 0xffffffff80000000 = 0
    8000008c:	00153513          	seqz	a0,a0
    // a0 = 0
    80000090:	f81ff0ef          	jal	ra,80000010 <nemu_assert>

addw rd, rs1, rs2 
	x[rd] = sext( (x[rs1] + x[rs2])[31:0]  )
åŠ å­—(Add Word). R-type, RV64I.æŠŠå¯„å­˜å™¨ x[rs2]åŠ åˆ°å¯„å­˜å™¨ x[rs1]ä¸Šï¼Œå°†ç»“æœæˆªæ–­ä¸º 32 ä½ï¼ŒæŠŠç¬¦å·ä½æ‰©å±•çš„ç»“æœå†™å…¥ x[rd]ã€‚
å¿½ç•¥ç®—æœ¯æº¢å‡º

seqz rd, rs1 
	x[rd] = (x[rs1] == 0)
ç­‰äº 0 åˆ™ç½®ä½(Set if Equal to Zero). ä¼ªæŒ‡ä»¤, å¦‚æœ x[rs1]ç­‰äº 0ï¼Œå‘ x[rd]å†™å…¥ 1ï¼Œå¦åˆ™å†™å…¥ 0ã€‚å®é™…è¢«æ‰©å±•ä¸º sltiu rd, rs1, 1ã€‚

sltiu rd, rs1, immediate 
	x[rd] = (x[rs1] <ğ‘¢ sext(immediate))
æ— ç¬¦å·å°äºç«‹å³æ•°åˆ™ç½®ä½,æ¯”è¾ƒ x[rs1]å’Œæœ‰ç¬¦å·æ‰©å±•çš„ immediateï¼Œæ¯”è¾ƒæ—¶è§†ä¸ºæ— ç¬¦å·æ•°ã€‚å¦‚æœ x[rs1]æ›´å°ï¼Œå‘ x[rd]å†™å…¥1ï¼Œå¦åˆ™å†™å…¥ 0ã€‚
```



```
bit:
right pc = [0x        8000006c], wrong pc = [0x        8000008c]  cyc = 219

000000008000004c <setbit>:
    8000004c:	4035d793          	srai	a5,a1,0x3
    80000050:	ff010113          	addi	sp,sp,-16
    80000054:	00f50533          	add	a0,a0,a5
    80000058:	00a13423          	sd	a0,8(sp)
    8000005c:	0075f793          	andi	a5,a1,7
    80000060:	00100593          	li	a1,1
    80000064:	00f595bb          	sllw	a1,a1,a5
    80000068:	00813783          	ld	a5,8(sp)
    8000006c:	02061063          	bnez	a2,8000008c <setbit+0x40>	// a2 != 0, j 8c
    80000070:	0007c783          	lbu	a5,0(a5)
    80000074:	fff5c593          	not	a1,a1
    80000078:	00f5f5b3          	and	a1,a1,a5
    8000007c:	00813783          	ld	a5,8(sp)
    80000080:	00b78023          	sb	a1,0(a5)
    80000084:	01010113          	addi	sp,sp,16
    80000088:	00008067          	ret
    8000008c:	0007c783          	lbu	a5,0(a5)
    80000090:	00f5e5b3          	or	a1,a1,a5
    80000094:	00813783          	ld	a5,8(sp)
    80000098:	0ff5f593          	andi	a1,a1,255
    8000009c:	00b78023          	sb	a1,0(a5)
    800000a0:	01010113          	addi	sp,sp,16
    800000a4:	00008067          	ret
```



æˆåŠŸä¿®å¤bug:

å°±æ˜¯æŒ‰ç…§mipsæœ‰å»¶è¿Ÿæ§½æŒºå¥½å¼„, ä½†riscvæ²¡æœ‰å»¶è¿Ÿæ§½, å¯¹äºè½¬ç§»æŒ‡ä»¤, æˆ‘ä¹‹å‰å¤„ç†æ–¹æ³•æ˜¯, è®©å®ƒçš„ä¸‹ä¸€æ¡æŒ‡ä»¤è¿›å…¥decæ—¶å€™åˆ·æ–°ds_valid = 0, è¿™æ ·å°±å˜æˆnopæŒ‡ä»¤äº†,  ä½†æ˜¯å¦‚æœè½¬ç§»æŒ‡ä»¤å‰é¢æœ‰loadæŒ‡ä»¤, ä¹Ÿä¼šè®©è½¬ç§»æŒ‡ä»¤é˜»å¡åœ¨dec, ç„¶åè½¬ç§»æŒ‡ä»¤å°±ç›´æ¥è¢«åˆ·æ–°æ‰äº†

```scala
  when(dec_reflush && ds_ready_go){
    ds_valid := false.B   // å¦‚æœexeæœ‰loadæŒ‡ä»¤, è¿˜è¦ç­‰ä¸‹ä¸€æ‹æ‰åˆ·æ–°, è¦ä¿è¯ä¸‹ä¸€æ‹èƒ½èµ°æ‰èƒ½åˆ·æ–°
  }.elsewhen(ds_allowin) {
    ds_valid := fs_to_ds_valid
  }
```



