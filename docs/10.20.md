#### 今日任务

1. 继续对sum  debug



addw 应该先sum, 在截断最后的32位, 符号扩展!

bug: lw, addw 会有问题

在dec需要, 如果load在exe, 需要dec阻塞一派, 保证浅底信号正确!

```scala
  val ds_ready_go = !(es_valid && exe_reg_ctrl_mem_ren)      // load 在exe, 要阻塞一下
```



bug:

cyc = 23 -> 24  dec 阻塞一次, 导致if的指令没了, 变成0!

解决了! 由于if阻塞, Iram_en = 0, 获取的inst=0 覆盖了, 所以改成只有需要更新才更新!

```scala
when(io.instReadIO.en){
  if_reg_inst := io.instReadIO.data   // 只有需要更新才更新!
}
```



bug:

reg 14 a4 different at pc = [0x        80000040], right=[0x              15], wrong=[0x               5]    cyc=68

解决了! 在存储时候对于mask没处理好, 改成这样

```c
paddr_t data_mask = data;
        switch (mask)
        {
        case 0b1:
            data_mask = data & 0xff; break;
        case 0b11:
            data_mask = data & 0xffff; break;
        case 0b1111:
            data_mask = data & 0xffffffff; break;
        case 0b11111111:
            data_mask = data & 0xffffffffffffffff; break;
        default:
            data_mask = data & 0xffffffffffffffff; break;
        }
        m_Dram[(addr - ADDRSTART) / sizeof(paddr_t)] = data_mask;
```

